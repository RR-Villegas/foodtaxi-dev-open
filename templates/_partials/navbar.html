<header class="navbar">
    <div class="logo">
        <a href="{{ url_for('index') }}">FoodTaxi Omega</a>
    </div>

    <!-- Search Bar -->
    <form class="search-form" action="{{ url_for('search') }}" method="GET">
        <input type="search" name="q" placeholder="Search products or stores..." aria-label="Search">
        <button type="submit">ğŸ”</button>
    </form>

    <nav class="nav-links">
        {% if current_user.is_authenticated %}

            <!-- GREETING -->
            <span class="user-greeting">
                Hello, {{ current_user.firstname }}!
            </span>

            <!-- ROLE-BASED NAVIGATION -->
            {% if current_user.account_type == "Buyer" %}
                <a href="{{ url_for('cart') }}">ğŸ›’ Cart (0)</a>

            {% elif current_user.account_type == "Seller" %}
                <a href="{{ url_for('seller_dashboard')}}">ğŸ›ï¸ Store Dashboard</a>

            {% elif current_user.account_type == "Rider" %}
                <a href="/rider/jobs">ğŸ“¦ Delivery Jobs</a>
                <a href="/rider/history">ğŸ“œ History</a>

            {% endif %}

            <!-- LOGOUT -->
            <a href="{{ url_for('logout') }}">Logout</a>

        {% else %}
            <!-- NOT LOGGED IN -->
            <a href="{{ url_for('login') }}">Login / Register</a>
        {% endif %}

        <!-- Mobile Hamburger Button -->
        <button id="hamburger-btn" class="hamburger-btn" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </nav>
</header>

{# FIX: Include the external notification partial here #}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div id="flash-messages-container" class="notification-area">
    {% for category, message in messages %}
    <div class="flash-message flash-{{ category }}">
        {{ message }}
        <button class="close-flash-btn" onclick="this.parentElement.style.display='none';">&times;</button>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

<!-- Sidebar Menu -->
<div id="sidebar-menu" class="sidebar-menu">
    <button id="close-sidebar" class="close-sidebar" aria-label="Close menu">&times;</button>

    <div class="sidebar-content">

        {% if current_user.is_authenticated %}

            <p class="sidebar-user">
                Logged in as <strong>{{ current_user.account_type }}</strong>
            </p>

            {% if current_user.account_type == "Buyer" %}
                <a href="{{ url_for('cart') }}" class="sidebar-link">
                    ğŸ›’ Cart (0)
                </a>
                <a href="/orders" class="sidebar-link">ğŸ“¦ My Orders</a>

            {% elif current_user.account_type == "Seller" %}
                <a href="/seller/dashboard" class="sidebar-link">ğŸ›ï¸ Seller Dashboard</a>
                <a href="/seller/products" class="sidebar-link">ğŸ“¦ Manage Products</a>
                <a href="/seller/orders" class="sidebar-link">ğŸ“‘ Store Orders</a>

            {% elif current_user.account_type == "Rider" %}
                <a href="/rider/jobs" class="sidebar-link">ğŸ“¦ Delivery Jobs</a>
                <a href="/rider/history" class="sidebar-link">ğŸ“œ Delivery History</a>

            {% endif %}

            <a href="{{ url_for('logout') }}" class="sidebar-link">Logout</a>

        {% else %}
            <!-- NOT LOGGED IN -->
            <a href="" class="sidebar-link">ğŸ›’ Cart (1)</a>
            <a href="{{ url_for('seller_application') }}" class="sidebar-link">Become a Seller</a>
            <a href="{{ url_for('rider_application') }}" class="sidebar-link">Become a Rider</a>
        {% endif %}

        <div class="sidebar-divider"></div>

        <!-- Theme Switcher -->
        <div class="theme-switcher">
            <label for="theme-select">Theme</label>
            <select id="theme-select" class="theme-select">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="koishi">Koishi</option>
            </select>
        </div>
    </div>
</div>

<!-- Overlay -->
<div id="sidebar-overlay" class="sidebar-overlay"></div>
