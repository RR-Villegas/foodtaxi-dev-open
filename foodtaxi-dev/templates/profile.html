{% extends "navin.html" %}
{% block title %}Profile{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
<script src="{{ url_for('static', filename='js/profile.js') }}"></script>

<section class="profile-container">
  <h2>My Profile</h2>

  <div class="profile-picture-section">
    <img id="profile-picture" src="{{ url_for('get_encrypted_image', filename=user.profile_image) if user.profile_image else url_for('static', filename='images/default-profile.png') }}" alt="Profile Picture" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%;">
    <br>
    <button id="change-picture-btn">Change Profile Picture</button>
  </div>

  <!-- Modal for changing profile picture -->
  <div id="profile-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border-radius: 8px; width: 400px;">
      <h3>Change Profile Picture</h3>
      <form id="profile-picture-form" action="/update_profile_picture" method="post" enctype="multipart/form-data">
        <input type="file" id="profile-picture-input" name="profile_image" accept="image/*" required>
        <p id="error-message" style="color: red; display: none;">Please select a square image (1:1 aspect ratio).</p>
        <button type="submit" id="submit-btn" disabled>Upload</button>
        <button type="button" id="close-modal">Cancel</button>
      </form>
    </div>
  </div>

  <div class="profile-card">
    <table class="profile-table">
      <tr>
        <td><strong>User Type:</strong></td>
        <td colspan="3">{{ user.user_type.title() if user.user_type else 'Not set' }}</td>
      </tr>
      <tr>
        <td><strong>First Name:</strong></td>
        <td>{{ user.first_name or 'Not set' }}</td>
        <td><strong>Last Name:</strong></td>
        <td>{{ user.last_name or 'Not set' }}</td>
      </tr>
      <tr>
        <td><strong>Email:</strong></td>
        <td colspan="3">{{ user.email or 'Not set' }}</td>
      </tr>
      <tr>
        <td><strong>Mobile Number:</strong></td>
        <td colspan="3">{{ user.mobile_number or 'Not set' }}</td>
      </tr>
      <tr>
        <td><strong>Home #:</strong></td>
        <td>{{ user.home_number or 'Not set' }}</td>
        <td><strong>Street:</strong></td>
        <td>{{ user.street or 'Not set' }}</td>
      </tr>
      <tr>
        <td><strong>Barangay:</strong></td>
        <td>{{ user.barangay or 'Not set' }}</td>
        <td><strong>Municipality:</strong></td>
        <td>{{ user.municipality or 'Not set' }}</td>
      </tr>
      <tr>
        <td><strong>City:</strong></td>
        <td>{{ user.city or 'Not set' }}</td>
        <td><strong>Province:</strong></td>
        <td>{{ user.province or 'Not set' }}</td>
      </tr>
      <tr>
        <td><strong>Zip Code:</strong></td>
        <td colspan="3">{{ user.zip_code or 'Not set' }}</td>
      </tr>
    </table>
  </div>

</section>
{% endblock %}
