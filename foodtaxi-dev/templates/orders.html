{% extends "navin.html" %}

{% block title %}My Orders{% endblock %}

{% block preload %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/orders.css') }}">
{% endblock %}

{% block content %}
<h2 class="page-title">My Orders</h2>

{% if orders %}
<div class="orders-container">

  {% for order in orders %}
    <div class="order-card">
        <!-- Order Header -->
        <div class="order-header">
          <h3>Order #{{ order.order_id }}</h3>
          <p>Status: <span class="order-status {{ order.order_status|lower }}">{{ order.order_status }}</span></p>
          <p>Payment Method: {{ order.payment_method|upper }}</p>
          <p>Order Date: {{ order.order_date.strftime('%b %d, %Y %I:%M %p') }}</p>

          <!-- Cancel button only if order is processing -->
          {% if order.order_status|lower == 'processing' %}
          <form action="{{ url_for('cancel_order', order_id=order.order_id) }}" method="POST" class="cancel-form">
              <button type="submit" class="cancel-btn">Cancel Order</button>
          </form>
          {% endif %}
        </div>

        <!-- Order Items -->
        <div class="order-items">
          {% for item in order.order_products %}
          <div class="order-item">
            <div class="order-item-image-wrapper">
              <img src="{{ url_for('static', filename='images/profile/' ~ item.image) }}" 
                   alt="{{ item.product_name }}" class="order-item-image" >
            </div>

            <div class="order-item-details-card">
              <h4>{{ item.product_name }}</h4>
              {% if item.maker %}<p class="product-maker">by {{ item.maker }}</p>{% endif %}
              {% if item.description %}<p class="product-description">{{ item.description }}</p>{% endif %}
              <p>Price: ₱{{ "%.2f"|format(item.price_each) }}</p>
              <p>Quantity: {{ item.quantity }}</p>
              <p>Subtotal: ₱{{ "%.2f"|format(item.subtotal) }}</p>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Order Total -->
        <div class="order-total-card">
          Total Price: ₱{{ "%.2f"|format(order.total_price) }}
        </div>
    </div>
  {% endfor %}

</div>
{% else %}
<p class="empty-orders">You have no orders yet.</p>
{% endif %}
{% endblock %}
